---
title: "Which World Record is Most Impressive?"
author: "Duncan Gates"
output:
  rmdformats::html_docco:
    self_contained: true # Other options are downcute, material, readthedown, html_clean, html_docco, lockdown, https://github.com/juba/rmdformats
    thumbnails: false
    lightbox: true
    gallery: false
    highlight: kate
    number_sections: false
    includes: 
      after_body: footer.html
---


```{r include = F}
library(gganimate)
library(rvest)
library(xml2)
library(tidyverse)
library(hrbrthemes)
library(here)
library(knitr)
library(lubridate)

## Global options
options(max.print="75")
opts_chunk$set(echo=FALSE,
	             cache=TRUE,
               prompt=FALSE,
               tidy=TRUE,
               comment=NA,
               message=FALSE,
               warning=FALSE)
opts_knit$set(width=100)

htmltools::tagList(rmarkdown::html_dependency_font_awesome()) # Needed so fa's in footer will show
theme_set(theme_ipsum_pub())
```

<center>
## Running World Records
</center>

This plot shows men's world records for running at each distance.

```{r}
# xlsx::write.xlsx(mens_world_records, "mens_world_records.xlsx") # Not sure how to change times like I need to here -> character to numeric and in hms, ms, and s format so I just wrote it to excel and used =cellvalue *86400 which makes it seconds
# /Users/dunk/Projects/Athletics/mens_world_records.xlsx
# /Users/dunk/Projects/Athletics/womens_world_records.xlsx
mens_world_records_seconds <- readxl::read_excel("/Users/dunk/Github/Athletics/mens_world_records.xlsx", range = "B1:G46")
womens_world_records_seconds <- readxl::read_excel("/Users/dunk/Github/Athletics/womens_world_records.xlsx", range = "B1:G50")
womens_world_records_seconds_join <- womens_world_records_seconds %>% 
  slice(1:25) %>%
  mutate(Gender = "Women")
mens_world_records_seconds_join <- mens_world_records_seconds %>%
  slice(1:21) %>% 
  mutate(Gender = "Men")
mens_womens_records <- full_join(womens_world_records_seconds_join, mens_world_records_seconds_join)
mens_world_records_seconds %>% 
  mutate(Perf = as.numeric(Perf),
         Discipline = factor(Discipline, levels = c("100 Metres","200 Metres","400 Metres","800 Metres","1000 Metres","1500 Metres",
                                                    "One Mile","2000 Metres","3000 Metres","5000 Metres", "5 Kilometres", "10,000 Metres", "10 Kilometres","20,000 Metres","One Hour","Half Marathon","25,000 Metres","30,000 Metres","Marathon","100 Kilometres"))) %>%
  slice(1:21) %>%
  slice(-15, -11, -13, -16) %>% # SELECT OUT UNNECESSARY ONES: kamworor old world record for half, mo farah for timed distance, cheptegei and kipruto for road records
  ggplot(aes(x = Discipline, y = Perf, group = 1)) + 
  geom_point() + 
  stat_summary(fun.y = sum, geom = "line") +
  scale_y_time() + 
  labs(x = "Distance", y = "Time") +
  theme(axis.text.x = element_text(angle = 90))
```

Separated into Track, Middle Distance, and Long Distance

```{r}
mens_world_records_seconds %>% 
  mutate(Perf = as.numeric(Perf),
         Discipline = factor(Discipline, levels = c("100 Metres","200 Metres","400 Metres","800 Metres","1000 Metres","1500 Metres",
                                                    "One Mile","2000 Metres","3000 Metres","5000 Metres", "5 Kilometres", "10,000 Metres", "10 Kilometres","20,000 Metres","One Hour","Half Marathon","25,000 Metres","30,000 Metres","Marathon","100 Kilometres"))) %>%
  slice(1:4) %>%
  slice(-15, -11, -13, -16) %>% # SELECT OUT UNNECESSARY ONES: kamworor old world record for half, mo farah for timed distance, cheptegei and kipruto for road records
  ggplot(aes(x = Discipline, y = Perf, group = 1)) + 
  geom_text(aes(label = Competitor), size = 2, nudge_y = 5) + 
  stat_summary(fun.y = sum, geom = "line") +
  scale_y_time() + 
  labs(x = "Distance", y = "Time", title = "Track Records") +
  theme(axis.text.x = element_text(angle = 90),
        plot.title = element_text(hjust = 0.5))
```

```{r}
mens_world_records_seconds %>% 
  mutate(Perf = as.numeric(Perf),
         Discipline = factor(Discipline, levels = c("100 Metres","200 Metres","400 Metres","800 Metres","1000 Metres","1500 Metres",
                                                    "One Mile","2000 Metres","3000 Metres","5000 Metres", "5 Kilometres", "10,000 Metres", "10 Kilometres","20,000 Metres","One Hour","Half Marathon","25,000 Metres","30,000 Metres","Marathon","100 Kilometres"))) %>%
  slice(5:10) %>%
  ggplot(aes(x = Discipline, y = Perf, group = 1)) + 
  geom_text(aes(label = Competitor), size = 2, nudge_y = 20) + 
  stat_summary(fun.y = sum, geom = "line") +
  scale_y_time() + 
  labs(x = "Distance", y = "Time", title = "Middle Distance Records") +
  theme(axis.text.x = element_text(angle = 90),
        plot.title = element_text(hjust = 0.5))
```

```{r}
mens_world_records_seconds %>% 
  mutate(Perf = as.numeric(Perf),
         Discipline = factor(Discipline, levels = c("100 Metres","200 Metres","400 Metres","800 Metres","1000 Metres","1500 Metres",
                                                    "One Mile","2000 Metres","3000 Metres","5000 Metres", "5 Kilometres", "10,000 Metres", "10 Kilometres","20,000 Metres","One Hour","Half Marathon","25,000 Metres","30,000 Metres","Marathon","100 Kilometres"))) %>%
  slice(14:21) %>%
  slice(-2, -3, -8) %>% # SELECT OUT UNNECESSARY ONES: kamworor old world record for half, mo farah for timed distance, cheptegei and kipruto for road records
  ggplot(aes(x = Discipline, y = Perf, group = 1)) + 
  geom_text(aes(label = Competitor), size = 2, nudge_y = 250) + 
  stat_summary(fun.y = sum, geom = "line") +
  scale_y_time() + 
  labs(x = "Distance", y = "Time", title = "Long Distance Records") +
  theme(axis.text.x = element_text(angle = 90),
        plot.title = element_text(hjust = 0.5))
```

Plotting Men's and Women's World Records Together.

```{r}
mens_womens_records %>% 
  slice(-11,-12,-14,-15,-17,-18,-23,-36,-40,-38,-41) %>%
  mutate(Perf = as.numeric(Perf),
         Discipline = factor(Discipline, levels = c("100 Metres","200 Metres","400 Metres","800 Metres","1000 Metres","1500 Metres",
                                                    "One Mile","2000 Metres","3000 Metres","5000 Metres", "5 Kilometres", "10,000 Metres", "10 Kilometres","20,000 Metres","One Hour","Half Marathon","25,000 Metres","30,000 Metres","Marathon","100 Kilometres"))) %>%
  ggplot(aes(x = Discipline, y = Perf, color = Gender, group = Gender)) + 
  geom_point() + 
  geom_line() +
  scale_color_manual(values = c("dodgerblue1", "pink")) +
  scale_y_time() + 
  labs(x = "Distance", y = "Time", title = "All Distance Records") +
  theme(axis.text.x = element_text(angle = 90),
        plot.title = element_text(hjust = 0.5))
```

Split into smaller sections once again 

```{r fig.width = 10}
faceted_records <- mens_womens_records %>% 
  slice(-11,-12,-14,-15,-17,-18,-23,-36,-40,-38,-41) %>%
  mutate(Perf = as.double(Perf),
         Discipline = factor(Discipline, levels = c("100 Metres","200 Metres","400 Metres","800 Metres","1000 Metres","1500 Metres",
                                                    "One Mile","2000 Metres","3000 Metres","5000 Metres", "5 Kilometres", "10,000 Metres", "10 Kilometres","20,000 Metres","One Hour","Half Marathon","25,000 Metres","30,000 Metres","Marathon","100 Kilometres")))
faceted_records <- faceted_records %>%
  mutate(Distance = case_when(Perf < 120 ~ "Short Distance",
                              Perf > 120 & Perf < 1800 ~ "Middle Distance",
                              Perf > 1800 ~ "Long Distance")) %>%
  mutate(Distance = factor(Distance, levels = c("Short Distance", "Middle Distance", "Long Distance")))

ggplot(data = faceted_records, aes(x = Discipline, y = Perf, color = Gender, group = Gender)) + 
  geom_point() + 
  geom_line() +
  facet_wrap( ~ Distance, scales = "free") +
  scale_color_manual(values = c("dodgerblue1", "pink")) +
  scale_y_time(breaks = scales::breaks_pretty(10), limits = c(0, NA)) + 
  labs(x = "Distance", y = "Time", title = "Distance World Records") +
  theme(axis.text.x = element_text(angle = 90),
        plot.title = element_text(hjust = 0.5))
```

# Percent Difference At Each Distance

By this metric it appears that the most impressive world records are the men's 20,000 through 30,000 meters. This could also just be the result of these races being largely unimportant in the racing world, as evidenced by the jump in the ratio of the half marathon.

```{r fig.width = 13}
records_difference <- faceted_records %>% 
  pivot_wider(id_cols = Discipline, names_from = Gender, values_from = c(Perf))
records_difference$Women[13] <- 3871
records_difference <- records_difference %>%
  unnest(c(Men, Women)) %>%
  mutate(Ratio = Men/Women)
ggplot(records_difference, aes(x = Discipline, y = Ratio, fill = Ratio)) + 
  geom_col() +
  geom_text(aes(label = paste0(100*round(Ratio, 4), "%")), hjust = -0.1) +
  scale_y_continuous(labels = scales::percent, 
                     breaks = scales::breaks_pretty(n = 10)) +
  scale_fill_distiller(palette = "Blues") +
  coord_flip() +
  labs(title = "Difference in Men's and Women's Records", y = "Ratio (Women:Men)") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none")
```


NEED TO DO RUNNING PACE BY DISTANCE SEE (https://www.reddit.com/r/dataisbeautiful/comments/69m4xe/world_record_running_pace_by_distance_oc/).







# Progression of the 100 meter world record

The vast majority of world records have been broken at positive wind speeds, is this because the races are run in non-windy conditions, or wind speed has a drastic effect on runners? Given how minor the negative wind speeds are when it is broken, it is likely that this is because it is having a significant impact.

```{r fig.width = 10}
world_record_100_clean %>%
  mutate(Record = factor(Record, levels = c("Ratified", "Ratified but later Rescinded", "Not Ratified"))) %>%
  ggplot(aes(x = Date, y = Time, fill = Wind)) +
  geom_line() + 
  scale_fill_distiller(palette = "YlOrRd") +
  ggrepel::geom_label_repel(aes(label = ifelse(Record == "Ratified but later Rescinded" |
                                 Record == "Not Ratified", 
                                 Athlete, 
                                 "")), fill = "white") +
  ggrepel::geom_label_repel(aes(label = ifelse(Record == "Ratified" & Wind < 0,
                                               paste("Wind Speed:", Wind),
                                               ""),
                                fill = Wind)) +
  scale_x_date(breaks = scales::breaks_pretty(n = 10)) +
  facet_wrap( ~ Record) +
  labs(x = "Date", title = "World Records in the 100 Meters") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(angle = 90),
        legend.position = "none")
```

![](/Users/dunk/Github/Athletics/WindSpeed100m.png)
<!-- ![](/Users/dunk/Projects/NewWebsite.io/rmd/Records/WindSpeed100m.png) -->

```{r, include = F}
world_record_100_clean %>%
  mutate(Record = factor(Record, levels = c("Ratified", "Ratified but later Rescinded", "Not Ratified"))) %>%
  ggplot(aes(x = Date, y = Time, fill = Wind)) +
  geom_line() + 
  scale_fill_distiller(palette = "Greens") +
  ggrepel::geom_label_repel(aes(label = ifelse(Record == "Ratified but later Rescinded" |
                                 Record == "Not Ratified", 
                                 Athlete, 
                                 "")), fill = "white") +
  ggrepel::geom_label_repel(aes(label = ifelse(Record == "Ratified" & Wind > 0,
                                               paste("Wind Speed:", Wind),
                                               ""),
                                fill = Wind)) +
  scale_x_date(breaks = scales::breaks_pretty(n = 10)) +
  facet_wrap( ~ Record) +
  labs(x = "Date", title = "World Records in the 100 Meters") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(angle = 90),
        legend.position = "none")
```




# Percent Improvement for World Record Each Time

Usain Bolt is absolutely bonkers good, no one else has ever made such an individual dent into the 100 meter world record.

![](/Users/dunk/Github/Athletics/Improvement100m.png)
<!-- ![](/Users/dunk/Projects/NewWebsite.io/rmd/Records/Improvement100m.png) -->

```{r include = F}
record_improve <- world_record_100_clean %>%
  select(-`Day of Date`, -`Nationality_1`) %>%
  dplyr::filter(`Record` == "Ratified") %>%
  arrange(desc(Date)) %>%
  mutate(Time_diff = 1-(Time/lead(Time)))
ggplot(record_improve, aes(x = Date, y = Time, fill = Time_diff)) +
  geom_line() +
  ggrepel::geom_label_repel(aes(label = ifelse(Time_diff > 0,
                                               paste0(Athlete,
                                                      " (",
                                                      year(Date),
                                                      ")",
                                               "\n Improvement: ", 
                                               (100*round(Time_diff, 4)), 
                                               "%"), ""),
                                fill = Time_diff)) +
  scale_x_date(breaks = scales::breaks_pretty(n = 10)) +
  labs(x = "Date", title = "Ratified World Records in the 100 Meters") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(angle = 90),
        legend.position = "none")
```


Next step is to add an animation of each world record over time, need to get all that data first.

```{r}
record_improve_graph <- ggplot(record_improve, aes(x = Date, y = Time)) +
  geom_label(aes(label = Athlete)) +
  scale_x_date(breaks = scales::breaks_pretty(n = 10)) +
  labs(x = "Date", title = "Ratified World Records in the 100 Meters") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(angle = 90),
        legend.position = "none") +
  transition_time(Date) +
  ease_aes('linear')
animate(record_improve_graph,
        duration = 25,
        nframes = 25)
```


# Getting more data

```{r}
wikipedia_table_scrape <- function(url, xpath = '//*[@id="mw-content-text"]/div[1]/table[1]') {
  url <- url
  progression <- url %>% 
  read_html() %>% 
  html_nodes(xpath=xpath) %>% 
  html_table()
progression <- progression[[1]]
}
```


## 200m Data Obtain and Clean

```{r}
twohundred_progression_one <- wikipedia_table_scrape(url = "https://en.wikipedia.org/wiki/Men%27s_200_metres_world_record_progression",
                       xpath = '//*[@id="mw-content-text"]/div[1]/table[1]')
twohundred_progression_two <- wikipedia_table_scrape(url = "https://en.wikipedia.org/wiki/Men%27s_200_metres_world_record_progression",
                       xpath = '//*[@id="mw-content-text"]/div[1]/table[2]')
```


## 400m Data Obtain and Clean

```{r}
fourhundred_progression_one <- wikipedia_table_scrape(url = "https://en.wikipedia.org/wiki/Men%27s_400_metres_world_record_progression",
                       xpath = '//*[@id="mw-content-text"]/div[1]/table[1]')
fourhundred_progression_two <- wikipedia_table_scrape(url = "https://en.wikipedia.org/wiki/Men%27s_400_metres_world_record_progression",
                       xpath = '//*[@id="mw-content-text"]/div[1]/table[2]')
```


## 800m Data Obtain and Clean

```{r}
eighthundred_progression <- wikipedia_table_scrape(url = "https://en.wikipedia.org/wiki/Men%27s_800_metres_world_record_progression")
```

## 1000m Data Obtain and Clean

```{r}
thousand_progression <- wikipedia_table_scrape(url = "https://en.wikipedia.org/wiki/1000_metres_world_record_progression")
```


## 1500m Data Obtain and Clean

```{r}
fifteenhundred_progression <- wikipedia_table_scrape(url = "https://en.wikipedia.org/wiki/1500_metres_world_record_progression",
                                                     xpath = '//*[@id="mw-content-text"]/div[1]/table[2]')
```


## Mile Data Obtain and Clean

```{r}
# /Users/dunk/Github/Athletics/Men's Mile Run Record Progression.xlsx
mile_progression <- readxl::read_excel("/Users/dunk/Projects/Athletics/Men's Mile Run Record Progression.xlsx")
mile_progression_clean <- mile_progression %>%
  mutate(Time = str_remove(Time, "\\*"),
         Time = str_remove(Time, "\\*"),
         Date = str_remove(Date, "\\[5\\]"),
         Date = dmy(Date))
```


## 3000m Data Obtain and Clean


```{r}
threethousand_progression <- wikipedia_table_scrape(url = "https://en.wikipedia.org/wiki/Men%27s_3000_metres_world_record_progression",
                                                     xpath = '//*[@id="mw-content-text"]/div[1]/table[2]')
```

## 2 mile Data obtain and clean

```{r}
twomile <- wikipedia_table_scrape(url = "https://en.wikipedia.org/wiki/Two_miles#World_Record_Progression",
                                                     xpath = '//*[@id="mw-content-text"]/div[1]/table[4]')
```


## 5000m Data Obtain and Clean

```{r}
fivethousand_progression <- wikipedia_table_scrape(url = "https://en.wikipedia.org/wiki/5000_metres_world_record_progression",
                                                     xpath = '//*[@id="mw-content-text"]/div[1]/table[2]')
```



## 10000m Data Obtain and Clean

```{r}
tenthousand_progression <- wikipedia_table_scrape(url = "https://en.wikipedia.org/wiki/10000_metres_world_record_progression",
                                                     xpath = '//*[@id="mw-content-text"]/div[1]/table[2]')
```



## Half Marathon Data Obtain and Clean

```{r}
halfmarathon <- wikipedia_table_scrape(url = "https://en.wikipedia.org/wiki/Half_marathon_world_record_progression")
```


## Marathon Data Obtain and Clean


```{r}
marathon <- wikipedia_table_scrape(url = "https://en.wikipedia.org/wiki/Marathon_world_record_progression",
                                                     xpath = '//*[@id="mw-content-text"]/div[1]/table[1]')
```


## Data combine and clean

```{r}
onehundred_progression_clean <- world_record_100_clean %>% select(Athlete, Date, Nationality, Time, `Location of race`) 
twohundred_progression_clean_one <- twohundred_progression_one %>% 
  select(Athlete, Date, Nationality, Time, `Location of race`) %>%
  mutate(Date = str_remove(Date, "\\[2\\]"),
         Date = str_remove(Date, "\\[3\\]"),
         Time = str_remove(Time, "y"),
         Time = str_remove(Time, "A"),
         Time = str_remove(Time, "\\+")) %>%
  mutate(Date = mdy(Date)) %>%
  mutate(Time = as.double(Time))
twohundred_progression_clean_two <- twohundred_progression_two %>% 
  select(Athlete, Date, Nationality, Time, `Location of race`) %>%
  mutate(Date = str_remove(Date, "\\[2\\]"),
         Date = str_remove(Date, "\\[1\\]\\[5\\]\\[6\\]"),
         Time = str_remove(Time, "y"),
         Time = str_remove(Time, " A"),
         Time = str_remove(Time, "\\+")) %>%
  mutate(Date = mdy(Date)) %>%
  mutate(Time = as.double(Time))
two_hundred_final <- bind_rows(twohundred_progression_clean_one, twohundred_progression_clean_two) %>% 
  mutate(Distance = "200 Meters")
oneandtwo <- onehundred_progression_clean %>% 
  mutate(Distance = "100 Meters") %>%
  bind_rows(two_hundred_final)

fourhundred_clean_one <- fourhundred_progression_one %>%
  select(Athlete, Date, Nationality, Time, `Location of race`) %>%
  mutate(Date = str_remove(Date, "\\[1\\]"),
         Date = str_remove(Date, "\\[2\\]"),
         Date = str_remove(Date, "\\[4\\]"),
         Date = str_remove(Date, "\\[note 1\\]\\[3\\]:49"),
         Time = str_remove(Time, "y"),
         Time = str_remove(Time, "A"),
         Time = str_remove(Time, "\\+")) %>%
  mutate(Date = mdy(Date)) %>%
  mutate(Time = as.double(Time))
fourhundred_clean_two <- fourhundred_progression_two %>%
  select(Athlete, Date, Nationality, Time, `Location of race`) %>%
  mutate(Date = str_remove(Date, "\\[1\\]"),
         Date = str_remove(Date, "\\[5\\]"),
         Time = str_remove(Time, " A")) %>%
  mutate(Date = mdy(Date)) %>%
  mutate(Time = as.double(Time))

fourhundred_clean_final <- bind_rows(fourhundred_clean_two, fourhundred_clean_one)

onetwofour <- fourhundred_clean_final %>%
  mutate(Distance = "400 Meters") %>% 
  bind_rows(oneandtwo)

eighthundred_clean <- eighthundred_progression %>%
  select(Athlete, Date, Time, `Location`) %>%
  mutate(Location = str_remove(Location, "\\[1\\]"),
         Date = str_remove(Date, "\\[5\\]"),
         Time = str_remove(Time, " A"),
         Time = str_remove(Time, "\\+"),
         Time = str_remove(Time, "y")) %>%
  mutate(Date = ymd(Date)) %>%
  mutate(Time = period_to_seconds(ms(Time))) %>%
  mutate(Time = as.double(Time)) %>%
  rename(`Location of race` = Location)

onetwofoureight <- eighthundred_clean %>%
  mutate(Distance = "800 Meters") %>%
  bind_rows(onetwofour)

thousand_progression_clean <- thousand_progression %>%
  mutate(Date = str_remove(Date, "\\[1\\]")) %>%
  mutate(Date = ymd(Date)) %>%
  mutate(Time = period_to_seconds(ms(Time))) %>%
  mutate(Time = as.double(Time)) %>%
  rename(Nationality = Country, `Location` = Venue) %>%
  mutate(Distance = "1000 Meters")
fivetot_clean <- onetwofoureight %>%
  rename(Location = `Location of race`) %>%
  bind_rows(thousand_progression_clean)

fifteenhundred_clean <- fifteenhundred_progression %>%
  select(-Auto) %>%
  rename(Location = Place) %>%
  mutate(Date = ymd(Date),
         Time = str_remove(Time, "\\+")) %>%
  mutate(Distance = "1500 Meters",
         Time = period_to_seconds(ms(Time)),
         Time = as.double(Time))
sixtot_clean <- fivetot_clean %>%
  bind_rows(fifteenhundred_clean)


mile_progression_final <- mile_progression_clean %>%
  select(Time, Athlete, Nationality, Date, Venue) %>%
  rename(Location = Venue) %>%
  mutate(Date = ymd(Date),
         Time = period_to_seconds(ms(Time)),
         Time = as.double(Time),
         Distance = "One Mile")
seventot_clean <- sixtot_clean %>%
  bind_rows(mile_progression_final)  
  
threethousand_clean <- threethousand_progression %>%
  rename(Location = Place) %>%
  mutate(Date = str_remove(Date, "\\[1\\]"),
         Date = ymd(Date),
         Time = period_to_seconds(ms(Time)),
         Time = as.double(Time),
         Distance = "3000 Meters")
eighttot_clean <- seventot_clean %>%
  bind_rows(threethousand_clean)


twomile_clean <- twomile %>%
  rename(Nationality = PLACE, Athlete = ATHLETE, Date = DATE, Time = TIME) %>%
  mutate(Date = ymd(Date),
         Time = period_to_seconds(ms(Time)),
         Time = as.double(Time),
         Distance = "Two Mile")
ninetot_clean <- eighttot_clean %>%
  bind_rows(twomile_clean)

fivethousand_clean <- fivethousand_progression %>%
  mutate(Location = str_remove(Location, "\\[1\\]"),
         Location = str_remove(Location, "\\[4\\]"),
         Date = ymd(Date),
         Time = period_to_seconds(ms(Time)),
         Time = as.double(Time),
         Distance = "5000 Meters")
tentot_clean <- ninetot_clean %>%
  bind_rows(fivethousand_clean)

tenthousand_clean <- tenthousand_progression %>%
  select(-Auto) %>%
  rename(Location = Place) %>%
  mutate(Location = str_remove(Location, "\\[1\\]"),
         Date = mdy(Date),
         Time = period_to_seconds(ms(Time)),
         Time = as.double(Time),
         Distance = "10000 Meters")
eleventot_clean <- tentot_clean %>%
  bind_rows(tenthousand_clean)

halfmarathon_clean <- halfmarathon %>%
  select(Time, Nationality, Date, Name, `Event/Place`) %>%
  rename(Location = `Event/Place`, Athlete = Name) %>%
  arrange(Time) %>%
  mutate(Location = str_remove(Location, "\\[1\\]"),
         Date = dmy(Date),
         Time = ifelse(Date <= "1993-04-15", period_to_seconds(hms(Time)), period_to_seconds(ms(Time))),
         Time = as.double(Time),
         Distance = "Half Marathon")
halfmarathon_clean$Time[40] <- 3624
twelvetot_clean <- eleventot_clean %>%
  bind_rows(halfmarathon_clean)

marathon_clean <- marathon %>%
  select(Time, Nationality, Date, Name, `Event/Place`) %>%
  rename(Location = `Event/Place`, Athlete = Name) %>%
  arrange(Time) %>%
  mutate(Date = str_remove(Date, "\\[nb 6\\]"),
         Date = mdy(Date),
         Time = period_to_seconds(hms(Time)),
         Time = as.double(Time),
         Distance = "Marathon")
thirteentot_clean <- twelvetot_clean %>%
  bind_rows(marathon_clean)
write_rds(thirteentot_clean, "/Users/dunk/Projects/Athletics/RunningRecordsOverTime.rds")
```

## Quick plot and gganimate

```{r}
runningrecords <- read_rds("/Users/dunk/Projects/Athletics/RunningRecordsOverTime.rds")

records_label <- runningrecords %>% 
  group_by(Distance) %>%
  slice(which.min(Time))

ggplot(runningrecords, aes(x = Date, y = Time, color = factor(Distance))) +
  geom_line() +
  geom_label(data = records_label, aes(label = Distance), hjust = -0.1) +
  scale_color_viridis_d() +
  scale_y_time(breaks = scales::breaks_pretty(n = 10)) +
  theme(legend.position = "none")

runningrecords %>%
  mutate(Distance = factor(Distance, levels = c("100 Meters","200 Meters","400 Meters","800 Meters","1000 Meters","1500 Meters",
                                                    "One Mile","2000 Meters","3000 Meters","5000 Meters", "10000 Meters", "Half Marathon","Marathon"))) %>%
  arrange(Distance) %>%
  slice(1:153) %>%
  ggplot(aes(x = Date, y = Time, color = Distance)) +
  geom_line() +
  scale_color_viridis_d() +
  scale_y_time(breaks = scales::breaks_pretty(n = 10)) +
  ggtitle("Short Distance Track Records Over Time") +
  theme(legend.position = "none")

runningrecords %>%
  mutate(Distance = factor(Distance, levels = c("100 Meters","200 Meters","400 Meters","800 Meters","1000 Meters","1500 Meters",
                                                    "One Mile","2000 Meters","3000 Meters","5000 Meters", "10000 Meters", "Half Marathon","Marathon"))) %>%
  arrange(Distance) %>%
  slice(154:350) %>%
  ggplot(aes(x = Date, y = Time, color = Distance)) +
  geom_line() +
  scale_color_viridis_d() +
  scale_y_time(breaks = scales::breaks_pretty(n = 10)) +
  ggtitle("Middle Distance Track Records Over Time") +
  theme(legend.position = "none")

runningrecords %>%
  mutate(Distance = factor(Distance, levels = c("100 Meters","200 Meters","400 Meters","800 Meters","1000 Meters","1500 Meters",
                                                    "One Mile","2000 Meters","3000 Meters","5000 Meters", "10000 Meters", "Half Marathon","Marathon"))) %>%
  arrange(Distance) %>%
  slice(350:474) %>%
  ggplot(aes(x = Date, y = Time, color = Distance)) +
  geom_line() +
  scale_color_viridis_d() +
  scale_y_time(breaks = scales::breaks_pretty(n = 10)) +
  ggtitle("Long Distance Track Records Over Time") +
  theme(legend.position = "none")

```

Which records have improved the most?

```{r}
runningrecords %>%
  group_by(Distance) %>%
  slice(which.min(Time), which.max(Time)) %>%
  mutate(Difference = 1/ (Time / lead(Time)),
         `Improvement Time` = year(Date) - year(lead(Date))) %>%
  arrange(desc(Difference)) %>%
  gt::gt()
```






